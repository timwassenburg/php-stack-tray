app-id: org.example.PHPStackTray
runtime: org.kde.Platform
runtime-version: '6.8'
sdk: org.kde.Sdk
command: php-stack-tray

finish-args:
  # Display access for system tray
  - --socket=fallback-x11
  - --socket=wayland
  - --share=ipc
  # Session D-Bus for notifications
  - --socket=session-bus
  # Access to run pkexec for privilege escalation
  - --talk-name=org.freedesktop.PolicyKit1
  # Allow running host commands (pkexec, systemctl)
  - --talk-name=org.freedesktop.Flatpak

build-options:
  build-args:
    - --share=network

modules:
  - name: php-stack-tray
    buildsystem: simple
    build-commands:
      - pip3 install --prefix=/app .
      - install -Dm644 data/org.example.PHPStackTray.desktop /app/share/applications/org.example.PHPStackTray.desktop
      - install -Dm644 data/org.example.PHPStackTray.metainfo.xml /app/share/metainfo/org.example.PHPStackTray.metainfo.xml
      - install -Dm644 data/icons/php-stack-tray.svg /app/share/icons/hicolor/scalable/apps/org.example.PHPStackTray.svg
    sources:
      - type: dir
        path: ..
