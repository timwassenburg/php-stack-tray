// Polkit rules for PHP Stack Tray
// Install to: /etc/polkit-1/rules.d/50-php-stack-tray.rules
//
// This allows users in the 'wheel' group to manage systemd services
// with authentication cached for the session (auth_admin_keep)

polkit.addRule(function(action, subject) {
    // Only apply to systemd unit management actions
    if (action.id == "org.freedesktop.systemd1.manage-units" ||
        action.id == "org.freedesktop.systemd1.manage-unit-files" ||
        action.id == "org.freedesktop.systemd1.reload-daemon") {

        // User must be in wheel group (admin)
        if (subject.isInGroup("wheel") || subject.isInGroup("sudo")) {
            // Return auth_admin_keep - asks for password once per session
            return polkit.Result.AUTH_ADMIN_KEEP;
        }
    }
});
